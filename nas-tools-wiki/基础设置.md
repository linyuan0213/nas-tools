---
title: 基础设置
description: 
published: 1
date: 2023-05-13T08:44:48.027Z
tags: 
editor: markdown
dateCreated: 2023-05-12T04:46:17.364Z
---

# 系统
## Web管理用户密码

- 默认用户为`admin`，默认密码为：`password`
> 首次登录后务必按提示修改管理用户密码，使用默认密码同时暴露地址到公网可能造成入侵及信息泄露风险！
{.is-warning}

## 代理服务器

- 将使用代理访服务器访问`themoviedb`、`telegram`等境外网站及程序更新(git)，站点默认不使用代理，如需使用需在站点维护中开启.
- 配置格式示例：`127.0.0.1:7890`（Http协议）、`socks5://127.0.0.1:8018`、`socks5h://127.0.0.1:8018`(remote DNS)。
- 代理中使用用户认证：` socks5://user:password@127.0.0.1:7891`

## 外网访问地址

- 使用该地址进行`通知点击跳转`以及设置Telegram机器人Webhook。
- 需要配置IP地址和端口，如为https则需要加`https://`前缀。
- 如启用Telegram机器人Webhook，则端口必须为：`443`, `80`, `88`, `8443`之一，80、443一般运营商会封禁，建议使用`88`、`8443`。

## User-Agent

- 系统全局网络请求时默认使用的User-Agent，未在`站点维护`中维护站点的User-Agent时将默认使用。
- 如发现被豆瓣、PT站等封堵，可修改此项。

## 仅检查Releases更新

- 开启后只有`Release`更新，才会有更新提示，小版本号更新不提示。

## 自定义CSS/Javascript

- 通过`自定义CSS`，所以用NAStool的UI风格进行修改。
- 通过`自定义Javascip`t，所以在打开WEB页面时执行动作，以及辅助CSS修改页面风格。

# 媒体
## TMDB API Key

- 在`www.themoviedb.org`网站申请API Key。
- 该项必须配置，否则所有功能无法正常运行.

## TMDB API Url

- 选择访问TMDB API时使用的地址，`api.themoviedb.org`、`api.tmdb.org`为官方地址，其余为使用代理中转，如无法连接TMDB匹配媒体信息时可偿试更换。


## TMDB匹配模式

- **正常模式**：会提升文件命名不规范的资源（未标识年份、是否剧集等）识别成功率，但也可能会导致误识别率增加。
- **严格模式**：可以降低误识别率，但可能导致很多文件名/种子名中年份/剧集信息不正确的无法被识别（特别是剧集，需要是首播年份）。

## 二级分类策略

- 启用二级分类后会在电影/电视剧/动漫媒体库目录下按二级分类名建立子目录。
- 此处配置分类的策略名，保存后会自动生成默认配置，配置可修改。
- 如不需要启动分类，则该项配置为`空`。

**默认二级分类配置参考：**
```yaml
# 配置电影的分类策略， 配置为空或者不配置该项则不启用电影分类
movie:
  # 分类名同时也是目录名，会按先后顺序匹配，匹配后程序会按这个名称建立二级目录
  动画电影:
    # 匹配 genre_ids 内容类型，16是动漫
    genre_ids: '16'
  华语电影:
    # 分类依据，可以是：original_language 语种、production_countries(电影)/origin_country(电视剧) 国家或地区、genre_ids 内容类型等，只要TMDB API返回的字段中有就行
    # 配置多项条件时，需要同时满足；不需要的匹配项可以删掉或者配置为空
    # 匹配值对应用,号分隔，这里是匹配语种
    original_language: 'zh,cn,bo,za'
  # 未配置任何过滤条件时，则按先后顺序不符合上面分类的都会在这个分类下，建议配置在最末尾
  外语电影:

# 配置电视剧的分类策略， 配置为空或者不配置该项则不启用电视剧分类
tv:
  # 分类名同时也是目录名，会按先后顺序匹配，匹配后程序会按这个名称建立二级目录
  # 如果有配置动漫独立目录，则实际上不会使用到tv下的动漫二级分类
  动漫:
    # 匹配 genre_ids 内容类型，16是动漫
    genre_ids: '16'
  纪录片:
     # 匹配 genre_ids 内容类型，99是纪录片
    genre_ids: '99'
  儿童:
    # 匹配 genre_ids 内容类型，10762是儿童
    genre_ids: '10762'
  综艺:
    # 匹配 genre_ids 内容类型，10764 10767都是综艺
    genre_ids: '10764,10767'
  国产剧:
    # 匹配 origin_country 国家，CN是中国大陆，TW是中国台湾，HK是中国香港
    origin_country: 'CN,TW,HK'
  欧美剧:
    # 匹配 origin_country 国家，主要欧美国家列表
    origin_country: 'US,FR,GB,DE,ES,IT,NL,PT,RU,UK'
  日韩剧:
    # 匹配 origin_country 国家，主要亚洲国家列表
    origin_country: 'JP,KP,KR,TH,IN,SG'
  # 未匹配以上分类，则命名为未分类
  未分类:

# 配置动漫的分类策略， 配置为空或者不配置该项则不启用动漫分类
anime:
  # 如果你的anime_path动漫目录已经直接设置到了动漫子目录，则这个分类可以取消
  动漫:
    # 匹配 genre_ids 内容类型，16是动漫
    genre_ids: '16'

## genre_ids 内容类型 字典，注意部分中英文是不一样的
#	28	Action
#	12	Adventure
#	16	Animation
#	35	Comedy
#	80	Crime
#	99	Documentary
#	18	Drama
#	10751	Family
#	14	Fantasy
#	36	History
#	27	Horror
#	10402	Music
#	9648	Mystery
#	10749	Romance
#	878  Science Fiction
#	10770	TV Movie
#	53	Thriller
#	10752	War
#	37	Western
#	28	动作
#	12	冒险
#	16	动画
#	35	喜剧
#	80	犯罪
#	99	纪录
#	18	剧情
#	10751	家庭
#	14	奇幻
#	36	历史
#	27	恐怖
#	10402	音乐
#	9648	悬疑
#	10749	爱情
#	878	科幻
#	10770	电视电影
#	53	惊悚
#	10752	战争
#	37	西部

## original_language 语种 字典
#	af	南非语
#	ar	阿拉伯语
#	az	阿塞拜疆语
#	be	比利时语
#	bg	保加利亚语
#	ca	加泰隆语
#	cs	捷克语
#	cy	威尔士语
#	da	丹麦语
#	de	德语
#	dv	第维埃语
#	el	希腊语
#	en	英语
#	eo	世界语
#	es	西班牙语
#	et	爱沙尼亚语
#	eu	巴士克语
#	fa	法斯语
#	fi	芬兰语
#	fo	法罗语
#	fr	法语
#	gl	加里西亚语
#	gu	古吉拉特语
#	he	希伯来语
#	hi	印地语
#	hr	克罗地亚语
#	hu	匈牙利语
#	hy	亚美尼亚语
#	id	印度尼西亚语
#	is	冰岛语
#	it	意大利语
#	ja	日语
#	ka	格鲁吉亚语
#	kk	哈萨克语
#	kn	卡纳拉语
#	ko	朝鲜语
#	kok	孔卡尼语
#	ky	吉尔吉斯语
#	lt	立陶宛语
#	lv	拉脱维亚语
#	mi	毛利语
#	mk	马其顿语
#	mn	蒙古语
#	mr	马拉地语
#	ms	马来语
#	mt	马耳他语
#	nb	挪威语(伯克梅尔)
#	nl	荷兰语
#	ns	北梭托语
#	pa	旁遮普语
#	pl	波兰语
#	pt	葡萄牙语
#	qu	克丘亚语
#	ro	罗马尼亚语
#	ru	俄语
#	sa	梵文
#	se	北萨摩斯语
#	sk	斯洛伐克语
#	sl	斯洛文尼亚语
#	sq	阿尔巴尼亚语
#	sv	瑞典语
#	sw	斯瓦希里语
#	syr	叙利亚语
#	ta	泰米尔语
#	te	泰卢固语
#	th	泰语
#	tl	塔加路语
#	tn	茨瓦纳语
#	tr	土耳其语
#	ts	宗加语
#	tt	鞑靼语
#	uk	乌克兰语
#	ur	乌都语
#	uz	乌兹别克语
#	vi	越南语
#	xh	班图语
#	zh	中文
#	cn	中文
#	zu	祖鲁语

## origin_country 国家地区 字典
#	AR	阿根廷
#	AU	澳大利亚
#	BE	比利时
#	BR	巴西
#	CA	加拿大
#	CH	瑞士
#	CL	智利
#	CO	哥伦比亚
#	CZ	捷克
#	DE	德国
#	DK	丹麦
#	EG	埃及
#	ES	西班牙
#	FR	法国
#	GR	希腊
#	HK	香港
#	IL	以色列
#	IN	印度
#	IQ	伊拉克
#	IR	伊朗
#	IT	意大利
#	JP	日本
#	MM	缅甸
#	MO	澳门
#	MX	墨西哥
#	MY	马来西亚
#	NL	荷兰
#	NO	挪威
#	PH	菲律宾
#	PK	巴基斯坦
#	PL	波兰
#	RU	俄罗斯
#	SE	瑞典
#	SG	新加坡
#	TH	泰国
#	TR	土耳其
#	US	美国
#	VN	越南
#	CN	中国 内地
#	GB	英国
#	TW	中国台湾
#	NZ	新西兰
#	SA	沙特阿拉伯
#	LA	老挝
#	KP	朝鲜 北朝鲜
#	KR	韩国 南朝鲜
#	PT	葡萄牙
#	MN	蒙古国 蒙古

```

## TMDB图片代理

- 加速TMDB图片下载，留空使用TMDB官方地址。
- TMDB媒体图片无法显示，可参考使用：[TMDB图片代理](/公共资源#TMDB图片代理)。

## OpenAI API

- 自定义openai请求地址（请注意格式，请求地址需带有请求头且最后没有/号）。
- 不填默认使用`https://api.openai.com`。
- 支持`https://openai.api2d.net`。

> 注意：填写了该项后，则消息交互默认会触发ChatGPT问答，如需搜索资源，需在发送的名称前添加`订阅/搜索/下载`前缀。
{.is-warning}

## 下载优先规则

- 订阅及远程搜索下载将按此优先规则选择下载资源，但不管选择哪一种，都低于`过滤规则`命中的优先级。
- **站点优先**：优先选择优先级较高的站点的资源进行下载。
- **做种数优先**：优先选择做种数最多的资源进行下载。

> **站点优先时的排序规则**：`过滤规则` -> `站点` -> `做种数` -> `季数` -> `集数`。
> **做种数优先时的排序规则**：`过滤规则` -> `做种数` -> `站点` -> `季数` -> `集数`。


## 文传转移忽略

- **转移最小文件大小**：`小于`该大小的文件将会忽略，不进行转移重命名。
- **文件路径转移忽略词**：`文件路径`包含忽略词的，忽略转移，支持正则表达式，特殊字符需要`\`转义。
- **文件名转移忽略词**：`文件名`（包括扩展名）包含忽略词的，忽略转移，支持正则表达式，特殊字符需要`\`转义。

## 重命名格式

- 程序会按定义的命名格式对电影/电视剧进行重命名。
- `/`代表上下级目录，电影只支持两层：`目录名/文件名`，电视剧只支持三层：`目录名/季名/文件名`。
- `{}`内为占位符，转义为`{{}}`，占位符会使用文件识别出来的实际值替换；占位符外的字符会当成普通字符，直接体现在名称上。
- `占位符`字典参考：[电影占位符](/名词解释/电影占位符)、[电视剧占位符](/名词解释/电视剧占位符)。

## 刮削设置

- 打开`刮削元数据及图片`代表开始自动刮削，文件转移完成后会自动生成nfo元数据及图片文件保存在媒体相应目录。
- `刮削设置`可详细设置刮削内容，其中`演职人员中文`需要频繁访问豆瓣，且Emby不支持自动显示演员头像，`建议关闭`。
- TMDB无缩略图时，支持通过`ffmpeg`读取文件生成缩略图。

## 高质量文件覆盖

- 可通过在重命名格式中添加`版本`、`分辨率`、`视频编码`等占位符，实现重复下载同一电影/电视剧时保留多个版本文件。
- 文件转移时如按重命名格式发现文件已存在，打开此开关会使用`更大体积`的文件覆盖，否则不处理。

# 服务
## 订阅RSS周期

- 坊取`站点RSS地址`以匹配订阅的时间间隔，需要在订阅管理中设置订阅站点。
- 配置为`空`则不启动RSS订阅功能。
- 为了减小站点压力，最小周期不能小于`300秒`。

## 订阅搜索周期

- 定时对电影/电视剧订阅进行`站点存量资源检索`的时间间隔，用于对RSS订阅进行查漏补缺。
- `留空`关闭订阅定时搜索。
- 以`小时`为单位，最小间隔为`6小时`，设置小于6小时时将强制设定为6小时。
- **该项会对站点造成压力**，使用搜索功能来订阅不是常规手段，应尽量通过`维护站点RSS地址`实现订阅追新，如非必要请不要开启。

## 媒体库同步周期

- 定时同步媒体服务器数据到本地，用于展示媒体是否存在。表现为：媒体卡片右上角`绿色图标`、媒体详情显示`已入库`标签。
- `留空`关闭媒体库同步。

## 站点数据刷新周期

- `站点数据`自动刷新的时间周期。

**四种配置方法：**
- 配置间隔，单位`小时`，比如`23.5`。
- 配置固定时间，如`08:00`。
- 配置时间范围，如`08:00-09:00`，表示在该时间范围内随机执行一次。
- 配置5位cron表达式，如：`0 */6 * * *`，cron表达式规则参考：[cron表达式](/名词解释/cron表达式)。
- 配置为`空`则不启用自动站点数据刷新功能。

## 远程自动择优下载

- 启用后在微信、Telegram等发送名称后会按配置的下载优先规则及过滤规则自动择优下载。
- 否则需要点击链接跳转后手工选择，关闭后需要先维护好`外网访问地址`，否则无法点击跳转。

## 不完整自动添加订阅

- 启用后在微信、Telegram发送名称搜索下载不完整时将自动添加订阅。

# 安全
## 源地址

- 仅接收配置的地址范围内发送Webhook及消息请求，避免对外暴露的接口被恶意使用。
- 多个地址段用`,`号分隔，配置为`0.0.0.0/0`,`::/0`则不做限制。
- 使用Telegram WebHook且未做代理转发时推荐Telegram IPv4地址设置为：`149.154.160.0/20,91.108.4.0/22`，关闭Telegram WebHook时推荐Telegram IPv4地址设置为：`127.0.0.1`。

## API密钥

- 使用Jellyseerr、Overseerr等调用本程序订阅接口时，需要在Authorization中填入该密钥。
- API中`GET`类接口需要使用此API密钥调用。

## 验证外部请求的API密钥

- 启用后，需要在原来的NAStool API地址后面拼接 `?apikey=xxx` ，xxx 为API密钥，例如Emby回调接口由原来的 `http://nastool:3000/emby` 改为 `http://nastool:3000/emby?apikey=xxx`。
- 受影响的接口有：`plex`、`jellyfin`、`emby`、`telegram`、`synology`、`slack`、`ical`。
- 所有对外服务接口参考：[对外服务地址](/名词解释/对外服务地址)。

# 实验室
## 辅助识别

- 开启后，无法识别到媒体信息时会尝试猜测和纠正关键词并再次匹配。
- 会大大增加识别耗时，一般情况下不建议开启。

## WEB增强识别

- 开启后，通过TMDB的API无法识别到媒体信息时，会尝试通过`www.themoviedb.org`网站再次搜索匹配。
- 仅个别极端情况下有效，会大大增加识别耗时，一般情况下不建议开启

## ChatGPT增强识别

- 开启后，通过TMDB的API无法识别到媒体信息时，使用`ChatGPT`识别匹配，需要先填写OpenAI API Key。
- 效果较好，但是涉及API收费。

## TMDB缓存过期策略

- 开启TMDB缓存过期策略后，默认`7天`过期，过期缓存将被删除, 7天内访问过期时间可以被刷新。
- 建议开启，缓存过多记录会造成使用内存量增加。

## 默认搜索豆瓣资源

- 开启将使用`豆瓣`进行电影电视剧的名称搜索，允许中文名不完整时自动联想，但如豆瓣数据与TMDB不一致时可能会无法搜索.
- 关闭后使用`TMDB`的数据进行名称搜索，对中文支持没有豆瓣友好，但不会有无法搜索的问题。

## 优先使用英文名

- 开启后对于精确搜索场景将会优先使用`英文名`（从TMDB数据中获取）搜索，否则优先使用`中文名`搜索。
- 不管是否打开此项，第一次搜索名称没有资源时，都会自动使用另一个名称再次搜索。

